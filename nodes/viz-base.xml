<?xml version="1.0" standalone="no"?>

<kickstart interface="public">

	<description>
	Visualization Cluster support
	</description>

	<copyright>
	Copyright (c) 2000 - 2011 The Regents of the University of California.
	All rights reserved. Rocks(r) v5.4.3 www.rocksclusters.org
	
	</copyright>

	<changelog>
	$Log: viz-base.xml,v $
	Revision 1.49  2011/07/23 02:31:37  phil
	Viper Copyright
	
	Revision 1.48  2011/01/10 18:50:42  mjk
	*** empty log message ***
	
	Revision 1.47  2010/09/07 23:53:26  bruno
	star power for gb
	
	Revision 1.46  2010/02/24 00:49:11  mjk
	- nvidia driver auto updates, but still works fine if the cluster is
	  not on the network.  Each node polls/pulls from nvidia.com the latest
	  driver.  User can disable and control the driver manually.
	  No more Roll updates to refresh the nvidia driver
	- X11 modules controlled by viz_x11_modules attribute
	- DPMS added back in
	- rocks start|stop tile to turn wall on|off
	- usersguide fixes (still needs work)
	- add nvidia driver version to tile-banner
	- bump version to 5.3.1
	
	Revision 1.45  2009/06/18 22:24:24  mjk
	set 1024x768 for frontend only
	
	Revision 1.44  2009/06/18 20:05:48  mjk
	*** empty log message ***
	
	Revision 1.43  2009/06/18 18:51:33  mjk
	default mode is 1024x768
	
	Revision 1.42  2009/06/17 21:09:50  mjk
	attr controlled driver version
	
	Revision 1.41  2009/06/11 23:26:56  mjk
	- 32bit chromium support
	- QT4 and other google earth prereqs
	
	Revision 1.40  2009/06/10 02:56:22  mjk
	- new schema
	
	Revision 1.39  2009/05/30 00:12:51  mjk
	remove dmx and fvwm
	
	Revision 1.38  2009/05/01 19:07:24  mjk
	chimi con queso
	
	Revision 1.37  2009/01/28 20:45:52  mjk
	- make node files "public"
	- added glew to bootstap
	
	Revision 1.36  2008/10/18 00:56:18  mjk
	copyright 5.1
	
	Revision 1.35  2008/05/31 02:57:18  mjk
	- SAGE is back and works (mostly)
	- DMX building from source (in progress)
	- Updated nvidia driver
	
	Revision 1.34  2008/03/06 23:41:59  mjk
	copyright storm on
	
	Revision 1.33  2007/12/20 23:42:15  mjk
	*** empty log message ***
	
	Revision 1.32  2007/08/31 21:54:01  mjk
	can the real mplayer please stand up
	
	Revision 1.31  2007/08/23 18:38:04  mjk
	Cleanup sysctl
	Drop SAGE and MagicCarpet
	
	Revision 1.30  2007/07/27 17:30:21  mjk
	checkpoint
	
	Revision 1.29  2007/07/09 17:59:47  mjk
	*** empty log message ***
	
	Revision 1.28  2007/06/23 04:04:02  mjk
	mars hill copyright
	
	Revision 1.27  2007/06/11 18:37:41  bruno
	moved font configuration from viz to base roll -- all appliances need it.
	
	Revision 1.26  2007/06/07 16:46:10  bruno
	full pathname to mkfontdir
	
	Revision 1.25  2007/06/07 00:01:38  bruno
	create metadata in some font directories -- otherwise, xfs can't find a
	'fixed' font and X doesn't start
	
	Revision 1.24  2006/12/06 23:24:43  phil
	add magic carpet
	
	Revision 1.23  2006/12/06 19:49:45  phil
	add fltk
	
	Revision 1.22  2006/11/16 15:37:24  mjk
	VTK package is now called vtk
	vtk installed on tile nodes and server node
	
	Revision 1.21  2006/09/11 22:50:22  mjk
	monkey face copyright
	
	Revision 1.20  2006/08/10 00:12:04  mjk
	4.2 copyright
	
	Revision 1.19  2006/07/25 23:43:04  mjk
	working on vlc
	
	Revision 1.18  2006/06/27 23:38:14  bruno
	no longer replacing the standard useradd, so just use the standard useradd
	
	Revision 1.17  2006/03/23 00:18:57  mjk
	autologin is on tiles only (again)
	
	Revision 1.16  2006/02/14 23:58:54  mjk
	*** empty log message ***
	
	Revision 1.15  2006/02/14 01:15:48  mjk
	viz user on frontend is just another tile
	
	Revision 1.14  2006/02/14 01:04:04  mjk
	switch to fvwm
	
	Revision 1.13  2006/02/13 20:01:04  bruno
	openmotif has mwm which is installed and run on each viz node
	
	Revision 1.12  2006/02/10 01:10:31  mjk
	fix perms for viz on tiles
	
	Revision 1.11  2006/02/07 22:00:47  mjk
	add bootstrapping
	
	Revision 1.10  2006/01/13 00:01:17  mjk
	create viz account in installation mode
	
	Revision 1.9  2006/01/11 22:55:06  mjk
	autologin viz on frontend also
	
	Revision 1.8  2006/01/11 02:28:54  mjk
	sage works
	
	Revision 1.7  2005/10/12 18:11:10  mjk
	final copyright for 4.1
	
	Revision 1.6  2005/09/16 01:04:49  mjk
	updated copyright
	
	Revision 1.5  2005/07/13 01:22:03  mjk
	more foundation changes
	
	Revision 1.4  2005/06/28 22:34:46  mjk
	add quanta from evl
	
	Revision 1.3  2005/05/24 21:24:01  mjk
	update copyright, release is not any closer
	
	Revision 1.2  2005/04/25 23:25:32  bruno
	mode is perms
	
	Revision 1.1  2005/03/04 01:49:47  mjk
	*** empty log message ***
	
	Revision 1.19  2004/10/06 22:58:36  mjk
	fix cg name, add libGL spoofing
	
	Revision 1.18  2004/09/13 20:08:12  mjk
	set desktop in post section
	
	Revision 1.17  2004/09/13 19:34:09  mjk
	drop id:3: line
	
	Revision 1.16  2004/09/11 05:41:53  mjk
	added sdl node
	
	Revision 1.15  2004/09/11 05:25:05  mjk
	moved stuff into viz-rocks
	
	Revision 1.14  2004/09/09 21:35:54  mjk
	added SDL_image
	
	Revision 1.13  2004/09/09 21:01:28  mjk
	added SDL devel stuff and ttf support
	
	Revision 1.12  2004/09/08 21:57:12  mjk
	build one more time
	
	Revision 1.11  2004/09/08 20:31:48  mjk
	moved more common stuff into the master
	
	Revision 1.10  2004/09/08 20:09:31  mjk
	added rocks-viz, moved stuff from common to master node
	
	Revision 1.9  2004/09/03 19:52:09  mjk
	assume video on master also
	
	Revision 1.8  2004/09/01 23:00:24  mjk
	brown eye
	
	Revision 1.7  2004/08/11 17:19:15  bruno
	added openmotif-devel in order to build pixel blaster
	
	Revision 1.6  2004/08/04 15:30:04  mjk
	*** empty log message ***
	
	Revision 1.5  2004/07/16 15:30:35  mjk
	SDL
	
	Revision 1.4  2004/07/16 15:17:35  mjk
	add dmx
	
	Revision 1.3  2004/07/15 19:57:47  bruno
	added the rollercoaster demo
	
	Revision 1.2  2004/07/15 05:41:30  mjk
	*** empty log message ***
	
	Revision 1.1  2004/07/14 22:24:57  mjk
	new graph
	
	Revision 1.1  2004/01/14 20:47:09  mjk
	*** empty log message ***
	
	</changelog>

	<package>rocks-viz</package>
	<package>freeglut</package>
	<package>chromium</package>

	<package>glew</package>
	<package>libtool-ltdl-devel</package>

	<package>xorg-x11-Mesa-libGL</package>

<post>

<!-- Create the viz account on each node (avoid 411) -->
/usr/sbin/useradd -M -u402 -c "Viz X11 Owner" -d /opt/viz/etc viz

chown -R viz.viz /opt/viz/etc


<!--
The next two hacks setup the default runlevel to 5
and fixes GDM so this works (did not in Rocks 3.2.0)
-->

<file name="/etc/inittab"/>
gawk \
	'/id:3:initdefault:/ { print "id:5:initdefault:"; next; } \
	{ print; }' /etc/inittab &gt; /tmp/inittab
mv /tmp/inittab /etc/inittab

<file name="/usr/bin/gdm" perms="755">
#!/bin/sh
exec /usr/bin/gdm-binary "$@"
</file>


<!-- setup bogus GL libraries to chromium can run transparently -->

cd /opt/viz/lib/cr
ln -s /opt/viz/lib/libcrfaker.so libGL.so 
ln -s /opt/viz/lib/libcrfaker.so libGL.so.1
cd /opt/viz/lib32/cr
ln -s /opt/viz/lib32/libcrfaker.so libGL.so
ln -s /opt/viz/lib32/libcrfaker.so libGL.so.1


<!-- make dvd device readable so that users can play dvds -->
<file name="/etc/rc.d/rc.local" mode="append">
if [ -e /dev/dvd ]; then
	chmod ugo+rx /dev/dvd
fi
</file>

</post>


</kickstart>
